$.fn.extend({animateCss:function(b,a){this.addClass("animated "+b);this.one("animationend",function(c){$(this).removeClass("animated "+b);if(a){a()}});return this}});$(document).ready(function(){$(".search-form").on("submit",function(h){h.preventDefault();$search_mode=$("#search-mode");console.log($search_mode);$spinner=$search_mode.find(".js-spinner.product-search-spinner");$spinner.show();var g=$(this).serialize();var f=$(this).attr("action");$search_mode.show();$container=$search_mode.find(".js-results-container");$("#browse-mode").hide();$container.html("");$container.load(f+"?"+g+" #search-results",function(e){d();console.log(e);$spinner.hide();window.history.pushState("object or string","Title",f+"?"+g)})});function c(){$(".product-card-body, .product-link").fancybox({margin:[0,0],animationEffect:"fade",baseClass:"fancybox-overlay js-fix-scroll fancybox-overlay-fixed",btnTpl:{smallBtn:'<a data-fancybox-close class="close-button-base close-button-position-top-right" title="{{CLOSE}}"></a>'},spinnerTpl:'<div id="fancybox-loading"><div id="fancybox-loading-spinner"></div></div>',content:this,afterLoad:function(e){console.log(e);window.history.pushState("object or string","Title",e.current.src)},afterClose:function(){window.history.back()},clickContent:function(h,g){var i=h.opts.$orig.parent();if($(g.target).parents(".CardAction").length||$(g.target).hasClass("CardAction")){g.preventDefault();if($(g.target).parents(".CardAction").length){$btn=$(g.target).parents(".CardAction")}else{$btn=$(g.target)}var f=$btn.attr("href");$.ajax({url:f,contentType:"application/json",success:function(e){console.log(i);if(i.parents(".ProductCard").length){$ico=i.parents(".ProductCard").find(".like-action-link");active_class="is-liked";deactive_class=""}else{active_class="icon-heart-red";deactive_class="icon-heart";$ico=i.find(".like-action-icon")}console.log($ico);$like_count=i.find(".like-action-number");if("added" in e){$btn.addClass("is-liked");$ico.removeClass(deactive_class).addClass(active_class)}else{if("removed" in e){$btn.removeClass("is-liked");$ico.removeClass(active_class).addClass(deactive_class)}}$like_count.text(e.likes_count)}})}}})}function d(){c();$("#items, #search-results").on("click",function(h){console.log("asda");if($(h.target).parents(".like-action-link").length||h.target.className==="like-action-link"){h.preventDefault();console.log("sadas");if(h.target.className==="like-action-link"){$btn=$(h.target)}else{$btn=$(h.target).parents(".like-action-link")}var f=$btn.attr("href");$like_count=$btn.find(".like-action-number");var g="";var i="";if($btn.parents(".ProductCard").length){$ico=$btn;g="is-liked";i=""}else{g="icon-heart-red";i="icon-heart";$ico=$btn.find(".like-action-icon")}console.log($ico);$.ajax({url:f,contentType:"application/json",success:function(e){if("added" in e){$ico.removeClass(i).addClass(g)}else{if("removed" in e){$ico.removeClass(g).addClass(i)}}$like_count.text(e.likes_count)}})}})}d();$("#items, #search-results").on("DOMNodeInserted DOMNodeRemoved",function(f){c()});var b=function(){$(function(){var h,f,j,g,i;return g=!1,h=0.9,j=function(k){if(k.keyCode!==27){}else{if($(".PageHeader-wrapper").hasClass("is-viewingHeaderShare")){return f()}}},i=function(q){var t,n,k,p,e,m;return console.log("click"),n=$(q.target).closest(".js-headerShareCanvas"),e=$("<div class='Scrim Scrim--headerShare'></div>"),p=$(".js-headerShareButton"),m=$(".js-triggerHeaderShare"),t=$(".js-closeButtonAnimateTarget"),k=$(".js-pageHeaderCreatorAvatar"),n.append(e),t.velocity("transition.expandIn",{delay:200,duration:200,display:null}),m.velocity("transition.fadeOut",{duration:200,display:null}),k.velocity({translateY:-32,scale:0.5,opacity:0},{duration:75,display:null,ease:"ease-out"}),p.velocity("transition.expandIn",{delay:150,stagger:25,duration:150,ease:"ease-out",display:null}),e.velocity({opacity:h},{duration:400,ease:"ease-out",begin:function(){return $("body").addClass("is-viewingHeaderShare")},complete:function(){return $("body").on("keyup",j),$("body").on("click",".js-closeHeaderShare",f),$("body").addClass("is-restingHeaderShare")}})},f=function(){var n,p,l,k,m;return g?!0:(g=!0,k=$(".Scrim--headerShare"),m=$(".js-triggerHeaderShare"),n=$(".js-closeButtonAnimateTarget"),l=$(".js-headerShareButton"),p=$(".js-pageHeaderCreatorAvatar"),n.velocity("transition.fadeOut",{duration:200,display:null}),m.velocity("transition.expandIn",{delay:100,duration:200}),p.velocity({translateY:0,scale:1,opacity:1},{delay:150,duration:100,display:null,ease:"ease-out"}),l.velocity("transition.expandOut",{stagger:50,duration:300,display:null,ease:"ease-out",backwards:null,begin:function(){return $("body").removeClass("is-restingHeaderShare")},complete:function(){return $("body").removeClass("is-viewingHeaderShare"),$("body").off("click",".js-closeHeaderShare",f),$("body").off("keyup",j),k.remove(),g=!1}}),k.velocity({opacity:0},{duration:400,ease:"ease-out"}))},$("body").on("click",".js-triggerHeaderShare",i)})}.call(this);var a=function(){var g,f=function(i,h){return function(){return i.apply(h,arguments)}};$(function(){return window.searchController=new g,searchController.searchOnLoad(),$(document.body).on("click",".js-cancelSearchMode",function(){return $(document).trigger("Search:showSearchMode",!1)})}),g=function(){function h(){this.searchDispatch=f(this.searchDispatch,this),this.$document=$(document),this.$browseMode=$("#browse-mode"),this.$searchMode=$("#search-mode"),this.pendingSearches={},this.inSearchMode=!1,this.previousScrollPos=null,this.initListeners()}return h.prototype.initListeners=function(){return this.$document.on("Search:requestSearch",function(i){return function(e,j){return i.searchDispatch(j)}}(this)),this.$document.on("Search:showSearchMode",function(i){return function(e,j){return i.showSearchMode(j)}}(this)),this.$document.on("Search:requestMobileSearch",function(i){return function(e,j){return i.showMobileSearchInput(j)}}(this)),window.addEventListener("popstate",function(i){return function(e){return e.state&&e.state.query?(i.showSearchMode(!0),i.searchDispatch(query)):(i.showSearchMode(!1),i.$document.trigger("Search:requestClearSearchInput"),$(".js-globalSearchInput").blur())}}(this))},h.prototype.searchOnLoad=function(){var j,i;return window.location.pathname.indexOf("/search")>-1&&(j=window.location.search.parseQueryString(),j.q)?(i=j.q,$(document).trigger("Search:updateQuery",i),$(document).trigger("Search:requestSearch",i)):void 0},h.prototype.showMobileSearchInput=function(i){return i?document.body.classList.add("is-showingMobileSearchInput"):(document.body.classList.remove("is-showingMobileSearchInput"),this.clearSearchResults(),this.showSearchMode(!1),this.$document.trigger("Search:requestClearSearchInput"),$("#mobileSearchInput").focus())},h.prototype.showSearchMode=function(i){return i?(this.previousScrollPos=this.$document.scrollTop(),this.$browseMode.hide(),this.$searchMode.show(),this.inSearchMode=!0):(this.$browseMode.show(),this.$document.scrollTop(this.previousScrollPos),this.$searchMode.hide(),this.inSearchMode=!1)},h.prototype.clearSearchResults=function(){return $("#search-container").html("")},h.prototype.search=function(k,i){var m,j,l;return m=$(".js-"+k+"-search-section"),m.show(),m.find(".js-empty-state").hide(),m.find(".js-spinner").show(),m.find(".js-results-container").hide(),m.find(".js-message").hide(),j=function(){return function(o){var n;return m.find(".js-spinner").hide(),n=$(o.trim()),0===n.length?m.find(".js-empty-state").show():(m.find(".js-empty-state").hide(),m.find(".js-results-container").html(o),m.find(".js-results-container").show(),m.find(".js-message").show(),ReactRailsUJS.mountComponents()),setUpSmoothScroll()}}(this),null!=(l=this.pendingSearches[k])&&l.abort(),this.pendingSearches[k]=$.ajax("/ajax/"+k+"_search",{dataType:"html",data:{query:i},success:j})},h.prototype.searchDispatch=function(m){var k,q,l,p,j;return $(".js-asin-search-section").hide(),$(".js-amazon-search-section").hide(),$(".js-product-search-section").hide(),$(".js-canopy-search-section").hide(),this.inSearchMode||this.clearSearchResults(),(null!=m?m.length:void 0)>0?(this.clearSearchResults(),this.showSearchMode(!0)):this.showSearchMode(!1),m=m.trim(),q="Searched",p={originating:!0,query:m},SegmentAnalytics.canopyTrack(q,p),j=encodeURI(m.trim()),window.history.pushState({query:m},"Search: query","/search?q="+j),l=m.match("/([A-Z0-9]{10})(/|\\?|$)"),k=m.match(/canopy\.co.*\/products\/([0-9]+)/),l?this.search("asin",l[1]):k?this.search("canopy",k[1]):this.search("product",m),$("body").animate({scrollTop:-$($(".search-summary")[0]).offset().top},200)},h}()}.call(this);$(".NavAction--showSearch").on("click",function(){return $(document).trigger("Search:requestMobileSearch",!0)});$(".GlobalNav-cancelMobileSearch").on("click",function(){return $(document).trigger("Search:requestMobileSearch",!1)});$("#filter-form input[type='radio']").on("change",function(){$form=$(this).parents("form");var e=$form.attr("action");var g=$form.attr("method");var f=$form.serialize();$items=$("#items");$items.html('<div class="js-spinner product-search-spinner">\n    <div class="vertical-center-outer">\n        <div class="vertical-center-inner">\n            <div class="product-loader-icon search animated spin">\n                <span>\n                    Loading...\n                </span>\n            </div>\n        </div>\n    </div>\n</div>');$.ajax({url:e,method:g,data:f,success:function(h){setTimeout(function(){$items.html(h)},300)},error:function(h){alert("На сервере произошла ошибка, извините за временные неудобства");$items.remove(".product-search-spinner")}})})});