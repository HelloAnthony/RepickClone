$.fn.extend({animateCss:function(b,a){this.addClass("animated "+b);this.one("animationend",function(c){$(this).removeClass("animated "+b);if(a){a()}});return this}});$(document).ready(function(){$("#modal-window").on("click",function(c){$modal=$(this);if(c.target.className==="fancybox-overlay js-fix-scroll fancybox-overlay-fixed"||c.target.className==="close-button-base close-button-position-top-right"){$modal.fadeOut(function(){$("html").removeClass("fancybox-margin fancybox-lock")})}if($(c.target).parents(".CardAction").length||c.target.className==="CardAction--showText CardAction CardAction--like"){if($(c.target).parents(".CardAction").length){$btn=$(c.target).parents(".CardAction")}else{$btn=$(c.target)}var b=$btn.attr("href");$.ajax({url:b,contentType:"application/json",success:function(d){$prev_item=$('.feed-card[data-product-id="'+$modal.attr("data-product-id")+'"]');$ico=$prev_item.find(".like-action-icon");$like_count=$prev_item.find(".like-action-number");if("added" in d){$btn.addClass("is-liked");$ico.removeClass("icon-heart").addClass("icon-heart-red")}else{if("removed" in d){$btn.removeClass("is-liked");$ico.removeClass("icon-heart-red").addClass("icon-heart")}}$like_count.text(d.likes_count)}})}});$(".search-form").on("submit",function(d){d.preventDefault();$search_mode=$("#search-mode");console.log($search_mode);$spinner=$search_mode.find(".js-spinner.product-search-spinner");$spinner.show();var c=$(this).serialize();var b=$(this).attr("action");$search_mode.show();$("#browse-mode").hide();$search_mode.find(".js-results-container").load(b+"?"+c+" #search-results",function(e){a();console.log(e);$spinner.hide()})});function a(){$("#items, #search-results").on("click",function(c){c.preventDefault();if($(c.target).parents(".product-card-body").length){console.log(c.target.className);c.preventDefault();$parent=$(c.target).parents(".product-card-body");$feed=$parent.parents(".feed-card");var b=$parent.attr("href");$modal=$("#modal-window");$modal.fadeIn();$.ajax({url:b,success:function(d){$modal.find(".fancybox-inner .wrapper").html(d);$modal.attr("data-product-id",$feed.attr("data-product-id"));$("html").addClass("fancybox-margin fancybox-lock")},error:function(e){console.log(e);if(e.status==404){alert("Данный товар не найден")}else{if(e.status==500){alert("Извините за временные неудобства, попробуйте позже")}}var d=$(this).parent().parent();d.animateCss("fadeOut",function(){d.removeClass("visible transition")});$("html").removeClass("fancybox-margin fancybox-lock")}})}if($(c.target).parents(".like-action-link").length||c.target.className==="like-action-link"){c.preventDefault();if(c.target.className==="like-action-link"){$btn=$(c.target)}else{$btn=$(c.target).parents(".like-action-link")}var b=$btn.attr("href");$ico=$btn.find(".like-action-icon");$like_count=$btn.find(".like-action-number");$.ajax({url:b,contentType:"application/json",success:function(d){if("added" in d){$ico.removeClass("icon-heart").addClass("icon-heart-red")}else{if("removed" in d){$ico.removeClass("icon-heart-red").addClass("icon-heart")}}$like_count.text(d.likes_count)}})}})}$("#loadmore").on("click",function(){});a();$(".search-form input").focus(function(b){$parent=$(this).parent();$parent.addClass("width_100p")});$(".search-form input").focusout(function(){$parent=$(this).parent();$parent.removeClass("width_100p")})});